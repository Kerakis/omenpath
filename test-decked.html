<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Decked Builder Test</title>
	</head>
	<body>
		<h1>Decked Builder Format Test</h1>
		<div>
			<input type="file" id="fileInput" accept=".csv" />
			<button onclick="testConverter()">Test Conversion</button>
		</div>
		<div id="results"></div>

		<script type="module">
			import { createConverterEngine } from './src/lib/converter-engine.js';

			window.testConverter = async function () {
				const fileInput = document.getElementById('fileInput');
				const resultsDiv = document.getElementById('results');

				if (!fileInput.files.length) {
					resultsDiv.innerHTML = '<p>Please select a CSV file first.</p>';
					return;
				}

				const file = fileInput.files[0];
				const converter = createConverterEngine();

				try {
					// Test format detection
					const text = await file.text();
					const headers = text.split('\n')[0].split(',');
					const detectedFormat = converter.detectFormat(headers);

					console.log('Headers:', headers);
					console.log('Detected format:', detectedFormat);

					resultsDiv.innerHTML = `
                    <h3>Format Detection Results</h3>
                    <p><strong>Detected Format:</strong> ${detectedFormat || 'None'}</p>
                    <p><strong>Headers:</strong> ${headers.join(', ')}</p>
                `;

					if (detectedFormat === 'decked-builder') {
						// Test parsing
						const parsedCards = await converter.parseFile(file, 'decked-builder');

						resultsDiv.innerHTML += `
                        <h3>Parsing Results</h3>
                        <p><strong>Total Cards Parsed:</strong> ${parsedCards.length}</p>
                        <h4>First 10 Cards:</h4>
                        <ul>
                    `;

						parsedCards.slice(0, 10).forEach((card) => {
							resultsDiv.innerHTML += `
                            <li>${card.name} - Count: ${card.count}, Foil: ${card.foil || 'none'}, 
                            Set: ${card.editionName}, Multiverse ID: ${card.multiverseId || 'none'}</li>
                        `;
						});

						resultsDiv.innerHTML += '</ul>';
					}
				} catch (error) {
					console.error('Test failed:', error);
					resultsDiv.innerHTML = `<p style="color: red;">Test failed: ${error.message}</p>`;
				}
			};
		</script>
	</body>
</html>
